!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("koa-browser",[],t):"object"==typeof exports?exports["koa-browser"]=t():e["koa-browser"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"KoaApp",function(){return a});var n=r(1),o=r.n(n),i=r(2);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(){s(this,e),this.middleware=[],this.ContextClass=function(e){function t(){return s(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(i.a),this.ctx=this.ContextClass.prototype}return e.prototype.use=function(e){this.middleware.push(e)},e.prototype.handler=function(){var e,t=this,r=o()(this.middleware);return e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var s=t[o](i),a=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}("next")})}}(regeneratorRuntime.mark(function e(n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new t.ContextClass(t,n),e.next=3,r(o);case 3:return e.abrupt("return",o.response.finalize());case 4:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}},e}()},function(e,t,r){"use strict";e.exports=function(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if("function"!=typeof t)throw new TypeError("Middleware must be composed of functions!");return function(t,r){let n=-1;return function o(i){if(i<=n)return Promise.reject(new Error("next() called multiple times"));n=i;let s=e[i];i===e.length&&(s=r);if(!s)return Promise.resolve();try{return Promise.resolve(s(t,function(){return o(i+1)}))}catch(e){return Promise.reject(e)}}(0)}}},function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(3),o=r.n(n),i=r(4),s=r(6);var a=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t,this.request=new i.a(this,r),this.response=new s.a(this)};o()(a.prototype,"response").method("attachment").method("redirect").method("remove").method("vary").method("set").method("append").method("flushHeaders").access("status").access("message").access("body").access("length").access("type").access("lastModified").access("etag").getter("headerSent").getter("writable"),o()(a.prototype,"request").method("acceptsLanguages").method("acceptsEncodings").method("acceptsCharsets").method("accepts").method("get").method("is").access("querystring").access("idempotent").access("socket").access("search").access("method").access("query").access("path").access("url").getter("origin").getter("href").getter("subdomains").getter("protocol").getter("host").getter("hostname").getter("URL").getter("header").getter("headers").getter("secure").getter("stale").getter("fresh").getter("ips").getter("ip")},function(e,t){function r(e,t){if(!(this instanceof r))return new r(e,t);this.proto=e,this.target=t,this.methods=[],this.getters=[],this.setters=[],this.fluents=[]}e.exports=r,r.prototype.method=function(e){var t=this.proto,r=this.target;return this.methods.push(e),t[e]=function(){return this[r][e].apply(this[r],arguments)},this},r.prototype.access=function(e){return this.getter(e).setter(e)},r.prototype.getter=function(e){var t=this.proto,r=this.target;return this.getters.push(e),t.__defineGetter__(e,function(){return this[r][e]}),this},r.prototype.setter=function(e){var t=this.proto,r=this.target;return this.setters.push(e),t.__defineSetter__(e,function(t){return this[r][e]=t}),this},r.prototype.fluent=function(e){var t=this.proto,r=this.target;return this.fluents.push(e),t[e]=function(t){return void 0!==t?(this[r][e]=t,this):this[r][e]},this}},function(e,t,r){"use strict";r.d(t,"a",function(){return s});var n=r(5),o=r.n(n),i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=t,this._url=new URL(r.url),this._method=r.method,this._headers=r.headers,this._querycache={}}return e.prototype.get=function(e){var t=this._headers;switch(e=e.toLowerCase()){case"referrer":return t.get("referer");default:return t.get(e)}},i(e,[{key:"URL",get:function(){return this._url}},{key:"header",get:function(){return this.headers},set:function(e){this.headers=e}},{key:"headers",get:function(){return this._headers},set:function(e){this._headers=new Headers(e)}},{key:"url",get:function(){return this._url.pathname+this._url.search+this._url.hash},set:function(e){var t=e.match(/^([^?#]*)(\?[^#]*)?(#.*)?$/);this._url.pathname=t[1],this._url.search=t[2]||"",this._url.hash=t[3]||""}},{key:"href",get:function(){return this._url.toString()}},{key:"method",get:function(){return this._method},set:function(e){this._method=e}},{key:"query",get:function(){var e=this.querystring,t=this._querycache[e];if(t)return t;t=this._querycache[e]={};var r=this._url.searchParams,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;t[s[0]]=s[1]}return Object.freeze(t)},set:function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n=window.encodeURIComponent(r),o=window.encodeURIComponent(e[r]);t.push(n+"="+o)}this.querystring=t.join("&")}},{key:"querystring",get:function(){return this.search.slice(1)},set:function(e){this.search=e}},{key:"fresh",get:function(){var e=this.method,t=this.ctx.status;return("GET"===e||"HEAD"===e)&&((t>=200&&t<300||304===t)&&this.fresh(this.header,this.ctx.response.header))}},{key:"stale",get:function(){return!this.fresh}},{key:"idempotent",get:function(){return!!~["GET","HEAD","PUT","DELETE","OPTIONS","TRACE"].indexOf(this.method)}},{key:"charset",get:function(){var e=this.get("Content-Type");if(!e)return"";try{e=o.a.parse(e)}catch(e){return""}return e.parameters.charset||""}},{key:"length",get:function(){var e=this.get("Content-Length");return""===e?0:~~e}},{key:"protocol",get:function(){return this.protocolWithColon.slice(0,-1)}},{key:"secure",get:function(){return"https"===this.protocol}},{key:"ips",get:function(){return[]}},{key:"subdomains",get:function(){return[]}},{key:"type",get:function(){var e=this.get("Content-Type");return e?e.split(";")[0]:""}}]),e}();function a(e,t){t||(t=e),Object.defineProperty(s.prototype,e,{get:function(){return this._url[t]},set:function(e){this._url[t]=e}})}a("origin"),a("path","pathname"),a("search"),a("host"),a("hostname"),a("protocolWithColon","protocol")},function(e,t,r){"use strict";
/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,o=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,a=/([\\"])/g,u=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(i.test(t))return t;if(t.length>0&&!o.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(a,"\\$1")+'"'}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!u.test(r))throw new TypeError("invalid type");var n=r;if(t&&"object"==typeof t)for(var o,s=Object.keys(t).sort(),a=0;a<s.length;a++){if(o=s[a],!i.test(o))throw new TypeError("invalid parameter name");n+="; "+o+"="+c(t[o])}return n},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;"function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]);if("string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var r=t.indexOf(";"),o=-1!==r?t.substr(0,r).trim():t.trim();if(!u.test(o))throw new TypeError("invalid media type");var i=new function(e){this.parameters=Object.create(null),this.type=e}(o.toLowerCase());if(-1!==r){var a,c,h;for(n.lastIndex=r;c=n.exec(t);){if(c.index!==r)throw new TypeError("invalid parameter format");r+=c[0].length,a=c[1].toLowerCase(),'"'===(h=c[2])[0]&&(h=h.substr(1,h.length-2).replace(s,"$1")),i.parameters[a]=h}if(r!==t.length)throw new TypeError("invalid parameter format")}return i}},function(e,t,r){"use strict";r.d(t,"a",function(){return s});var n=r(7),o=r.n(n),i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._headers=new Headers,this._status=404,this._body=null}return e.prototype.finalize=function(){var e=new Response(this._body,{status:this._status,headers:this._headers});return console.log("finalize",e),e},e.prototype.redirect=function(e,t){if("back"===e&&(e=this.ctx.get("Referrer")||t||"/"),this.set("Location",e),o.a.redirect[this.status]||(this.status=302),this.ctx.accepts("html"))return e=escape(e),this.type="text/html; charset=utf-8",void(this.body='Redirecting to <a href="'+e+'">'+e+"</a>.");this.type="text/plain; charset=utf-8",this.body="Redirecting to "+e+"."},e.prototype.attachment=function(e){},e.prototype.get=function(e){return this.header.get(e)},e.prototype.set=function(e,t){if(2===arguments.length)if(Array.isArray(t)){this._headers.set(e,t[0]);for(var r=1;r<t.length;r++)this._headers.append(e,t[r])}else this._headers.set(e,t);else for(var n in e)this.set(n,e[n])},e.prototype.append=function(e,t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this._headers.append(e,t[r]);else this._headers.append(e,t)},e.prototype.remove=function(e){this._headers.delete(e)},e.prototype.flushHeaders=function(){},i(e,[{key:"header",get:function(){return this._headers}},{key:"headers",get:function(){return this.header}},{key:"status",get:function(){return this._status},set:function(e){this._status=e}},{key:"message",get:function(){return this._statusMessage||o.a[this.status]},set:function(e){this._statusMessage=e}},{key:"body",get:function(){return this._body},set:function(e){this._body=e}},{key:"length",set:function(e){},get:function(){return 0}},{key:"headerSent",get:function(){return!1}},{key:"type",set:function(e){e?this.set("Content-Type",e):this.remove("Content-Type")},get:function(){var e=this.get("Content-Type");return e?e.split(";")[0]:""}},{key:"lastModified",set:function(e){"string"==typeof e&&(e=new Date(e)),this.set("Last-Modified",e.toUTCString())},get:function(){var e=this.get("last-modified");return e?new Date(e):null}},{key:"etag",set:function(e){/^(W\/)?"/.test(e)||(e='"'+e+'"'),this.set("ETag",e)},get:function(){return this.get("ETag")}},{key:"writable",get:function(){return!0}}]),e}()},function(e,t,r){"use strict";
/*!
 * statuses
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2016 Douglas Christopher Wilson
 * MIT Licensed
 */var n=r(8);function o(e){if("number"==typeof e){if(!o[e])throw new Error("invalid status code: "+e);return e}if("string"!=typeof e)throw new TypeError("code must be a number or string");var t=parseInt(e,10);if(!isNaN(t)){if(!o[t])throw new Error("invalid status code: "+t);return t}if(!(t=o[e.toLowerCase()]))throw new Error('invalid status message: "'+e+'"');return t}e.exports=o,o.STATUS_CODES=n,o.codes=function(e,t){var r=[];return Object.keys(t).forEach(function(n){var o=t[n],i=Number(n);e[i]=o,e[o]=i,e[o.toLowerCase()]=i,r.push(i)}),r}(o,n),o.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0},o.empty={204:!0,205:!0,304:!0},o.retry={502:!0,503:!0,504:!0}},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"(Unused)",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}}])});